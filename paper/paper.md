---
title: 'movetrack: An R package to model flight paths from large-scale radio-telemetry data'
tags:
  - R
  - animal movement
  - random walk
  - Hidden Markov Model
authors:
  - name: Georg Rüppel
    orcid: 0000-0001-5459-6717
    affiliation: 1
  - name: Thiemo Karwinkel
    orcid: 0000-0001-6433-3013
    affiliation: 1
  - name: Heiko Schmaljohann
    orcid: 0000-0002-0886-4319
    affiliation: 1
affiliations:
 - name: Institute for Biology and Environmental Sciences, Carl von Ossietzky University Oldenburg, Oldenburg, Germany
   index: 1
date: today
bibliography: paper.bib
---

# Summary

# Statement of need

1. Intro
- individual animal movements are highly complex and influence important large-scale ecological processes
- many species can be tracked with high accuracy using GPS
- but for small animals (i.e. songbirds, bats, or even insects) only automated radio-telemetry, e.g. the global collaborative Motus Wildlife Tracking System [@Taylor2017]
- challenging to extract locations. Currently, only coarse, tower-scale localisations are used

2. Current state
- directional antennas (e.g. Yagi antennas)
- triangulation based on angle [@Gottwald2019] or angle and distance [@Fisher2020]
- needs calibration to each new study site
- `aniMotum` [@Jonsen2023] for Argos data

3. Proposed solution
- Hidden Markov models (HMM) can leverage temporally irregular data with large and variable spatial errors to predict location and behavioural states [@Jonsen2005; @Jonsen2013; @Baldwin2018]
- flight paths

# Methodology
## Data structure and localisation

Unlike with data from GPS devices, geographic positions can not directly be inferred from radio-telemetry data. Instead, it is necessary to estimate the geographic positions of an animal from available information about the receiver location, antenna bearing and the strength of the detected radio signal. For this purpose, `movetrack` uses a geometric approach described in @Baldwin2018 that is implemented in the `locate()` function. This is a three-step process that utilizes basic principles of antenna geometry: 1) For each detection, a coarse location is estimated along the directional beam of the receiving antenna. The distance to the receiver is assumed to be half of the maximum detection range, which can be set antenna-type specific using the `aRange` argument. 2) All locations are provided with oscillating longitudinal and latitudinal measurement errors that arise from antenna geometry and orientation. 3) Locations and measurement errors from all antennas are aggregated over a desired time interval that can be set using the `dTime` argument. Finally, weighted means (by signal strength) of locations and measurement errors are calculated for each time interval. This data forms the basis of the observational part in the hidden Markov model.

## Hidden Markov model

HMM describe the evolution of a sequence of random variables, $\{S_t\}$ (i.e. behavioural states), which are not directly observable, but can be inferred from another sequence of random variables, $\{Y_t\}$, that are observable (i.e. locations) [@AugerMethe2021]. In the use case of `movetrack`, the hidden state sequence may alter between 'directed flight' or 'local movement', but the number of states affecting flight directionality can easily be set appropriately using the `states` argument. It is also possible to run a simple correlated random walk with only one state.

![Basic model structure showing the hidden state process $\{S_t\}$ governing the real locations $z$ and the observed locations $y$ at time $t$.](hmm.pdf)

Each true location $z$ is assumed to be generated by one of $N$ distributions, where $N$ is the number of states. The hidden state sequence that determines which of the distributions is chosen at time $t$ is modelled as a Markov chain, where the probability of being in each state at time $t$ depends only on the state value at the previous time step [@AugerMethe2021]. Finally, an observation model relates the true locations to the estimated locations and their measurement errors obtained from `locate()`. The HMM therefore consists of three components and is implemented in the `track()` function.

### State process

The state process $\{S_t\}$ of a $N$-state HMM for $T$ time steps is characterised by its state transition probability matrix $\Gamma^{(t)} = (\gamma^{(t)}_{i,j})$, where $i,j = 1, \dots, N$ and $\gamma^{(t)}_{i,j} = \text{Pr}(s_{t+1} = j|s_t = i)$. The probability of transitioning to state $s_t$ from state $s_{t-1}$ is

$$
s_t \sim \text{Categorical}(\Gamma^{(t-1)}),
    \quad 1 \leq t \leq T.
$$

### Process model

The process equation for the true locations of the animal at regular time intervals $t$, $z_t = \begin{bmatrix} z_{t, \text{lon}} \\ z_{t, \text{lat}} \end{bmatrix}$, assumes that the animal's location at time $t$ is not only dependent on the previous location, $z_{t-1}$, but also on the animal's previous displacement in each coordinate, $z_{t-1} - z_{t-2}$:

$$
z_t = z_{t-1} + \lambda_n (z_{t-1} - z_{t-2}) + \epsilon_t, 
    \quad \epsilon_t \sim \text{N}(0, \Omega),
    \quad 1 \leq n \leq N,
$$

where

$$
\Omega = 
    \begin{bmatrix} 
        \tau^2_{\epsilon, \text{lon}} & 0 \\ 
        0 & \tau^2_{\epsilon, \text{lat}} 
    \end{bmatrix}.
$$

The state-depended parameter, $\lambda_n$, can take values between 0 and 1 (i.e., $0 \leq \lambda \leq 1$), and controls the degree of correlation between steps. By default, `movetrack` estimates track-specific $\lambda_n$ values, but it is also possible to use the same $\lambda_n$ for all tracks by setting `i_lambda = FALSE`.

### Observation model

The observed locations of an animal, $y_j = \begin{bmatrix} y_{j, \text{lon}} \\ y_{j, \text{lat}} \end{bmatrix}$, often have irregular time intervals $j$, with $J$ representing the total number of observed locations. Therefore, the true location of the animal is linearly interpolated to the time of the observation, with $w_j$ representing the proportion of the regular time interval between $t-1$ and $t$ when the observation $y_j$ was made:

$$
y_j = w_j z_t + (1 - w_j) z_{t-1} + \theta_j, 
    \quad \theta_j \sim \text{T}(0, \sigma), 
    \quad 1 \leq j \leq J,
$$

where $\text{T}(0, \sigma)$ denotes a bivariate Student's $t$-distribution with measurement error $\sigma = \begin{bmatrix} \sigma_{\text{lon}} \\ \sigma_{\text{lat}} \end{bmatrix}$.

# Validation study

## Procedure

- On 9 and 11 of July 2024 we conducted test flights with a Robin DR 400.
- six uniquely coded NTQB2 tags (Lotek Wireless Inc.) with burst intervals 7.1, 7.3, 19.1, 29.3 attached to the undercarriage.
- Altitude ranged from to and flight speed ranged from to.
- We obtained data from a regional automated radio-telemetry receiver network along the German North Sea coast, which is part of the global collaborative Motus Wildlife Tracking System [@Taylor2017, [https://motus.org](https://motus.org)], and compared it with reference tracking data downloaded from [https://flightradar24.com](https://flightradar24.com).

## Results

# Discussion

Pull requests, bug reports, and all other forms of contributions to this project are welcomed and highly encouraged!

# Acknowledgements

We thank Renke Schütte for making the test flight possible. Funding was granted from German Federal Agency for Nature Conservation (BfN) with funds from the Federal Ministry for the Environment, Nature Conservation and Nuclear Safety (BMU), grants number 352315100B, to HS employing TK and GR.

# References
